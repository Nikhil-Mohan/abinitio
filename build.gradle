plugins {
    id 'base'
    id "org.sonarqube" version "7.1.0.6387"
}

sonar {
  properties {
    property "sonar.projectKey", "bindumounica_abinitio"
    property "sonar.organization", "bindumounica"
  }
}

ext {
    graphName = 'user_flow'
    versionTag = System.getenv("GITHUB_REF_NAME") ?: "local"
    imageName = "bindumounica87/abinitio-etl-poc:${versionTag}"
}

tasks.register('packageTar') {
    doLast {
        mkdir('build/dist')
        exec {
            commandLine 'tar',
                    '-cf',
                    'build/dist/abinitio-etl-poc-1.0.0.tar',
                    'graphs',
                    'runtime',
                    'transforms',
                    'data'
        }
    }
}

tasks.named('build') {
    dependsOn(tasks.named('packageTar'))
}
tasks.register('printHello') {
    doLast {
        println 'Hello, Ab Initio ETL Project Build!'
    }
}